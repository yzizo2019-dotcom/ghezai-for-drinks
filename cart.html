<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø³Ù„Ø©</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h1>
    <nav>
      <ul>
        <li><a href="index.html">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</a></li>
        <li><a href="cart.html">Ø§Ù„Ø³Ù„Ø©</a></li>
        <li><a href="login.html">Ø¯Ø®ÙˆÙ„</a></li>
      </ul>
    </nav>
  </header>

  <main class="cart-container">
    <h2>Ù…Ù†ØªØ¬Ø§ØªÙƒ</h2>
    <div id="cart-list" class="cart-list"></div>

    <div class="cart-summary">
      <div><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> <span id="total">0 Ø¯Ø¬</span></div>
      <div class="cart-actions">
        <button class="clear-btn" id="clear">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
        <button class="checkout-btn" id="checkout">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
      </div>
    </div>
  </main>

  <footer>
    <p>Â© 2025 Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„ØºØ§Ø²ÙŠØ© ÙˆØ§Ù„Ø¹ØµØ§Ø¦Ø±</p>
  </footer>

  <script>
    function formatCurrency(v) {
      return v + ' Ø¯Ø¬';
    }

    function renderCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const list = document.getElementById('cart-list');
      list.innerHTML = '';

      let total = 0;
      cart.forEach((item, idx) => {
        const subtotal = item.price * item.quantity;
        total += subtotal;

        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <div>
            <h4>${item.name}</h4>
            <div class="price">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ: ${formatCurrency(item.price)}</div>
            <div class="qty">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}</div>
            <div class="subtotal">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${formatCurrency(subtotal)}</div>
          </div>
          <button data-index="${idx}" class="remove-btn">âŒ Ø­Ø°Ù</button>
        `;
        list.appendChild(div);
      });

      document.getElementById('total').textContent = formatCurrency(total);

      list.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const i = Number(e.target.dataset.index);
          const cartNow = JSON.parse(localStorage.getItem('cart') || '[]');
          cartNow.splice(i, 1);
          localStorage.setItem('cart', JSON.stringify(cartNow));
          renderCart();
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderCart();

      document.getElementById('clear').addEventListener('click', () => {
        localStorage.removeItem('cart');
        renderCart();
      });

      document.getElementById('checkout').addEventListener('click', () => {
        const cartItems = JSON.parse(localStorage.getItem('cart') || '[]');
        const user = JSON.parse(localStorage.getItem('currentUser') || '{}');

        if (!user.email) {
          alert('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡.');
          window.location.href = 'login.html';
          return;
        }

        if (cartItems.length === 0) {
          alert('âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©ØŒ Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
          return;
        }

        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        const order = {
          customer: user,
          items: cartItems,
          total: cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0),
          date: new Date().toLocaleString()
        };

        orders.push(order);
        localStorage.setItem('orders', JSON.stringify(orders));
        localStorage.removeItem('cart');
        renderCart();

        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙŠØ§ ' + user.name);
      });
    });
  </script>
</body>
</html>
